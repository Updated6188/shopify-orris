<script src="{{ 'swiper-bundle.min.js' | asset_url }}" defer></script>

{{ 'swiper-bundle.min.css' | asset_url | stylesheet_tag: preload: true }}
{{ 'section-customer-love.css' | asset_url | stylesheet_tag: preload: true }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}


<div class="section-{{ section.id }}-padding gradient color-{{ section.settings.section_color_scheme }} share_design_sect share_design_sect--home">
  <div class="page-width-full">

    {%- if section.settings.heading != blank -%}
      <h2>{{ section.settings.heading }}</h2>
    {%- endif -%}

    {%- if section.settings.description != blank -%}
      <p>{{ section.settings.description }}</p>
    {%- endif -%}

    <div class="share_design_Sldr">
      <div class="swiper-wrapper">

        {% for block in section.blocks %}
        <div class="swiper-slide">
          <div class="share_designSldes">

            {% if block.settings.video_file != blank %}

              <!-- TRUE LAZY VIDEO -->
              <video
                class="swiper-video"
                playsinline
                preload="none"
                data-video-url="{{ block.settings.video_file.sources[0].url }}"
                data-video-type="{{ block.settings.video_file.sources[0].mime_type }}"
              ></video>

              <div class="play-layer">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                  <path d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"></path>
                </svg>
              </div>

            {% else %}
              <p>No video uploaded.</p>
            {% endif %}

          </div>
        </div>
        {% endfor %}

      </div>

      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>

    </div>
  </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function () {

  const swiper = new Swiper('.share_design_Sldr', {
    slidesPerView: 'auto',
    spaceBetween: 10,
    grabCursor: true,
    freeMode: true,
    loop: false,
    speed: 1000,
    keyboard: { enabled: true },
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    on: {
      slideChange: function () {
        resetVideos();
      }
    }
  });

  const videos = document.querySelectorAll('.swiper-video');
  const layers = document.querySelectorAll('.play-layer');

  function resetVideos() {
    videos.forEach((video, i) => {
      video.pause();
      video.currentTime = 0;
      layers[i].style.display = 'flex';
    });
  }

  layers.forEach((layer, index) => {
    layer.addEventListener('click', function () {

      resetVideos();

      const video = videos[index];

      // LOAD VIDEO ONLY WHEN CLICKED
      if (!video.querySelector('source')) {
        const source = document.createElement('source');
        source.src = video.dataset.videoUrl;
        source.type = video.dataset.videoType;
        video.appendChild(source);
        video.load();
      }

      layer.style.display = 'none';

      const playPromise = video.play();
      if (playPromise !== undefined) {
        playPromise.catch(() => {
          layer.style.display = 'flex';
        });
      }

    });
  });

  videos.forEach((video, index) => {

    video.addEventListener('click', function () {
      video.pause();
      layers[index].style.display = 'flex';
    });

    video.addEventListener('pause', function () {
      layers[index].style.display = 'flex';
    });

  });

});
</script>